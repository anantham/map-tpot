<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Grok Memorization Probe</title>
    <link rel="stylesheet" href="./styles.css" />
    <!-- Supabase (browser UMD) for fetch adapter -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.0/dist/umd/supabase.min.js"></script>
  </head>
  <body>
    <header>
      <h1>Grok Memorization Probe</h1>
      <p class="sub">Left: random tweet (Supabase). Right: model continuations.</p>
    </header>

    <section class="controls">
      <div class="control-group">
        <label>Models</label>
        <div class="models">
          <label><input type="checkbox" class="model" value="x-ai/grok-3" /> x-ai/grok-3</label>
          <label><input type="checkbox" class="model" value="x-ai/grok-3-mini" checked /> x-ai/grok-3-mini</label>
          <label><input type="checkbox" class="model" value="x-ai/grok-4" /> x-ai/grok-4</label>
          <label><input type="checkbox" class="model" value="x-ai/grok-code-fast-1" /> x-ai/grok-code-fast-1</label>
          <label><input type="checkbox" class="model" value="x-ai/grok-2-1212" checked /> x-ai/grok-2-1212</label>
          <label><input type="checkbox" class="model" value="x-ai/grok-2-mini" /> x-ai/grok-2-mini</label>
        </div>
      </div>
      <div class="control-group">
        <label for="preset">Presets</label>
        <select id="preset">
          <option value="strict">Strict · L=64 · k=1</option>
          <option value="long">Longer Prefix · L=128 · k=1</option>
          <option value="broader">Broader · L=64 · k=2</option>
          <option value="noisy">Noisy · L=64 · k=5</option>
          <option value="perturbed">Perturbed Meta · L=64 · k=1</option>
        </select>
      </div>
      <div class="control-group">
        <label for="prefixLen">Prefix length</label>
        <input id="prefixLen" type="number" min="8" max="256" step="8" value="64" />
      </div>
      <div class="control-group">
        <label for="topK">top_k</label>
        <select id="topK">
          <option>1</option>
          <option>2</option>
          <option>5</option>
        </select>
      </div>
      <div class="control-group">
        <label for="topP">top_p</label>
        <input id="topP" type="number" min="0" max="1" step="0.05" value="1" />
      </div>
      <div class="control-group">
        <label for="maxTokens">max_tokens</label>
        <input id="maxTokens" type="number" min="16" max="512" step="8" value="64" />
      </div>
      <div class="control-group">
        <label for="seed">seed</label>
        <input id="seed" type="number" min="0" step="1" value="7" />
      </div>
      <div class="control-group">
        <label><input id="perturbMeta" type="checkbox" /> Perturb metadata</label>
      </div>
      <div class="control-group">
        <label for="presencePenalty">presence_penalty</label>
        <input id="presencePenalty" type="number" min="-2" max="2" step="0.1" value="0" />
      </div>
      <div class="control-group">
        <label for="frequencyPenalty">frequency_penalty</label>
        <input id="frequencyPenalty" type="number" min="-2" max="2" step="0.1" value="0" />
      </div>
      <div class="control-group">
        <label for="repetitionPenalty">repetition_penalty</label>
        <input id="repetitionPenalty" type="number" min="0.5" max="2" step="0.05" value="1.0" />
      </div>
      <div class="control-group">
        <label for="stop">stop (comma-separated)</label>
        <input id="stop" type="text" placeholder="\n, \"" value="\n, &quot;" />
      </div>
      <div class="control-group">
        <label><input id="logprobs" type="checkbox" checked /> logprobs</label>
      </div>
      <div class="control-group">
        <label for="topLogprobs">top_logprobs</label>
        <input id="topLogprobs" type="number" min="1" max="20" step="1" value="5" />
      </div>
      <div class="control-group">
        <label for="minP">min_p</label>
        <input id="minP" type="number" min="0" max="1" step="0.01" />
      </div>
      <div class="control-group">
        <label for="topA">top_a</label>
        <input id="topA" type="number" min="0" max="1" step="0.01" />
      </div>
      <div class="control-group">
        <button id="btnFetch">Fetch Random Tweet</button>
        <button id="btnProbe" disabled>Run Probe</button>
      </div>
      <div id="status" class="status"></div>
    </section>

    <main class="grid">
      <aside class="left">
        <h2>Tweet</h2>
        <div id="tweetMeta" class="meta"></div>
        <div id="tweetText" class="tweet"></div>
        <details class="raw">
          <summary>Raw JSON</summary>
          <pre id="tweetRaw"></pre>
        </details>
      </aside>
      <section class="right">
        <h2>Model Continuations</h2>
        <div id="results" class="results"></div>
        <details class="history">
          <summary>History (last 10)</summary>
          <div id="history"></div>
        </details>
      </section>
    </main>

    <footer>
      <small>Tip: place your existing <code>fetchTweet.js</code> next to this page exporting <code>fetchRandomTweet()</code>. The UI will auto-detect it.</small>
    </footer>

    <script type="module" src="./app.js"></script>
  </body>
  </html>
